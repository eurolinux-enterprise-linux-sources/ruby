Index: ChangeLog
===================================================================
--- ChangeLog	(revision 39508)
+++ ChangeLog	(revision 39509)
@@ -1,3 +1,16 @@
+Tue Feb 26 23:26:13 2013  Kouhei Sutou  <kou@cozmixng.org>
+
+	* lib/rexml/document.rb: move entity_expansion_limit accessor to ...
+	* lib/rexml/rexml.rb: ... here to make rexml/text independent from
+	  REXML::Document. It causes circular require.
+	* lib/rexml/document.rb (REXML::Document.entity_expansion_limit):
+	  deprecated.
+	* lib/rexml/document.rb (REXML::Document.entity_expansion_limit=):
+	  deprecated.
+	* lib/rexml/text.rb: add missing require "rexml/rexml" for
+	  REXML.entity_expansion_limit.
+	  Reported by Robert Ulejczyk. Thanks!!! [ruby-core:52895] [Bug #7961]
+
 Fri Feb 22 18:31:46 2013  Aaron Patterson <aaron@tenderlovemaking.com>
 
 	* lib/rexml/document.rb (REXML::Document.entity_expansion_text_limit):
Index: lib/rexml/document.rb
===================================================================
--- lib/rexml/document.rb	(revision 39508)
+++ lib/rexml/document.rb	(revision 39509)
@@ -213,16 +213,18 @@
       return @@entity_expansion_limit
     end
 
-    @@entity_expansion_text_limit = 10_240
-
     # Set the entity expansion limit. By default the limit is set to 10240.
+    #
+    # Deprecated. Use REXML.entity_expansion_text_limit= instead.
     def Document::entity_expansion_text_limit=( val )
-      @@entity_expansion_text_limit = val
+      REXML.entity_expansion_text_limit = val
     end
 
     # Get the entity expansion limit. By default the limit is set to 10240
+    #
+    # Deprecated. Use REXML.entity_expansion_text_limit instead.
     def Document::entity_expansion_text_limit
-      return @@entity_expansion_text_limit
+      return REXML.entity_expansion_text_limit
     end
     attr_reader :entity_expansion_count
     
Index: lib/rexml/text.rb
===================================================================
--- lib/rexml/text.rb	(revision 39508)
+++ lib/rexml/text.rb	(revision 39509)
@@ -1,3 +1,4 @@
+require 'rexml/rexml'
 require 'rexml/entity'
 require 'rexml/doctype'
 require 'rexml/child'
@@ -383,7 +384,7 @@
       sum = 0
       string.gsub( /\r\n?/, "\n" ).gsub( REFERENCE ) {
         s = Text.expand($&, doctype, filter)
-        if sum + s.bytesize > Document.entity_expansion_text_limit
+        if sum + s.bytesize > REXML.entity_expansion_text_limit
           raise "entity expansion has grown too large"
         else
           sum += s.bytesize
Index: lib/rexml/rexml.rb
===================================================================
--- lib/rexml/rexml.rb	(revision 39508)
+++ lib/rexml/rexml.rb	(revision 39509)
@@ -28,4 +28,16 @@
 
   Copyright = COPYRIGHT
   Version = VERSION
+
+  @@entity_expansion_text_limit = 10_240
+
+  # Set the entity expansion limit. By default the limit is set to 10240.
+  def self.entity_expansion_text_limit=( val )
+    @@entity_expansion_text_limit = val
+  end
+
+  # Get the entity expansion limit. By default the limit is set to 10240.
+  def self.entity_expansion_text_limit
+    return @@entity_expansion_text_limit
+  end
 end
